<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Local Storage</title>
  <link rel="icon" type="image/x-icon" href="https://searchforurls.neocities.org/Images/foldericon.png">
  <style>
    /* Base styles for the body */
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      /* Default background color */
      margin: 0;
      padding: 0;
      transition: background-color 0.3s, color 0.3s;
      /* Added transition for smooth color change */
    }

    /* Styles for the header */
    header {
      background-color: #333;
      /* Header background color */
      color: #fff;
      /* Header text color */
      padding: 10px 0;
      text-align: center;
    }

    /* Styles for the container */
    .container {
      max-width: 800px;
      margin: 20px auto;
      /* Center the container horizontally */
      padding: 0 20px;
    }

    /* Styles for heading elements */
    h1 {
      margin-top: 0;
      /* Remove top margin */
    }

    /* Styles for paragraphs */
    p {
      margin-top: 5px;
      /* Top margin */
      margin-bottom: 20px;
      /* Bottom margin */
    }

    /* Styles for buttons */
    button {
      background-color: #4caf50;
      /* Button background color */
      color: #fff;
      /* Button text color */
      border: none;
      padding: 10px 20px;
      cursor: pointer;
      border-radius: 5px;
      transition: background-color 0.3s;
      /* Transition for hover effect */
    }

    /* Styles for the "Upload File" button */
    #fileInputButton {
      margin-bottom: 0px;
      /* Adjust the bottom margin as needed */
    }

    /* Styles for button hover effect */
    button:hover {
      background-color: #45a049;
    }

    /* Styles for select dropdown */
    select {
      padding: 10px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      background-color: #fff;
      /* Dropdown background color */
      color: #333;
      font-size: 16px;
      margin-bottom: 10px;
    }

    /* Styles for select dropdown options */
    select option {
      font-weight: bold;
    }

    /* Styles for warning text */
    .warning-text {
      color: red;
      /* Text color */
      font-style: italic;
    }

    /* Styles for the file list */
    .file-list {
      margin-top: 20px;
      /* Top margin */
      display: flex;
      /* Use flexbox */
      flex-wrap: wrap;
      /* Allow items to wrap */
      justify-content: flex-start;
      /* Start from the beginning */
    }

    /* Styles for unordered list */
    ul {
      list-style-type: none;
      /* Remove list bullets */
      padding: 0;
    }

    /* Styles for list items */
    li {
      margin-bottom: 10px;
      /* Bottom margin */
      padding: 10px;
      /* Padding */
      background-color: #fff;
      /* Default background color */
      border-radius: 5px;
      /* Rounded corners */
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      /* Box shadow for depth */
      display: flex;
      /* Flex layout */
      align-items: center;
      flex-wrap: wrap;
      /* Allow items to wrap */
    }

    /* Styles for buttons within list items */
    li button {
      margin-left: 10px;
      /* Left margin */
    }

    /* Responsive styles for smaller screens */
    @media only screen and (max-width: 600px) {

      /* Adjust margin for buttons */
      li button {
        margin-top: 5px;
        /* Adjust margin for smaller screens */
        margin-left: 0;
        /* Remove left margin */
        display: block;
        /* Display buttons as blocks */
      }
    }

    /* Styles for dark mode */
    .dark-mode {
      background-color: #222;
      /* Dark mode background color */
      color: #ddd;
      /* Dark mode text color */
    }

    /* Styles for list items in dark mode */
    .dark-mode li {
      color: #ddd;
      /* Text color */
      background-color: #444;
      /* Dark mode file background color */
    }

    /* Styles for file preview images */
    .file-preview {
      max-width: 100%;
      /* Maximum width */
      height: auto;
      /* Maintain aspect ratio */
    }
  </style>
</head>

<body>
  <!-- Main content container -->
  <div class="container">
    <p>Welcome! Use this as temporary storage.</p>
    <!-- Button to toggle dark mode -->
    <button id="darkModeToggle" title="Switch Appearance">Switch Appearance</button>
    <h2>Stats</h2>
    <p>Used Storage: <span id="usedStorage">Calculating...</span></p>
    <p>Total Available Storage: 10 MB (Depends on web browser)</p>
    <hr>
    <!-- Input field for file upload -->
    <input type="file" id="fileInput" style="display: none;">
    <!-- Button to trigger file selection -->
    <button id="fileInputButton" onclick="chooseFile()" title="Upload File">Upload File</button>
    <!-- Uploaded files section -->
    <div class="file-list">
      <h2>Uploaded Files:</h2>
      <!-- List of uploaded files -->
      <ul id="files"></ul>
    </div>
    <!-- Warning message for file uploads -->
    <div id="uploadMessage" class="warning-text" style="display: none;"></div>
    <hr>
    <!-- Warning message about using local storage -->
    <p class="warning-text" title="Please read this!">WARNING: I'm not to be held responsible for any lost or broken files. Use Local Storage with caution!</p>
    <h2>About</h2>
    <!-- Explanation about local storage -->
    <p>Local Storage harnesses JavaScript's local storage technology on the web to store files specifically for the device and browser being used. Currently, files stored in Local Storage cannot be transferred between different devices using Local Storage.</p>
  </div>

  <script>
    // Function to trigger file input click
    async function chooseFile() {
      document.getElementById("fileInput").click();
    }
    // Function to calculate used storage space
    function calculateUsedStorage() {
      let usedStorage = 0;
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        // Exclude items related to appearance storage
        if (key !== "appearanceMode") {
          const item = localStorage.getItem(key);
          usedStorage += key.length + item.length * 2;
        }
      }
      return usedStorage;
    }
    // Function to update storage information
    async function updateStorageInfo() {
      const usedStorage = calculateUsedStorage();
      document.getElementById("usedStorage").textContent = formatSize(usedStorage);
    }
    // Event listener for file input change
    document.getElementById("fileInput").addEventListener("change", async function(event) {
      const selectedFile = event.target.files[0];
      if (selectedFile) {
        if (selectedFile.size <= (5 * 1024 * 1024)) {
          const reader = new FileReader();
          reader.onload = async function(e) {
            const fileContent = e.target.result;
            await navigator.storage.persist();
            localStorage.setItem(selectedFile.name, fileContent);
            updateStorageInfo();
            addFileToList(selectedFile.name, selectedFile.size, fileContent);
            alert("File uploaded successfully!");
          };
          reader.readAsDataURL(selectedFile);
        } else {
          showUploadMessage("File is too big to upload.");
        }
      }
    });
    // Function to add file to list
    function addFileToList(fileName, fileSize, fileContent) {
      const filesList = document.getElementById("files");
      const listItem = document.createElement("li");
      listItem.textContent = `${fileName} (${formatSize(fileSize)})`;
      // View button
      const viewButton = document.createElement("button");
      viewButton.textContent = "View File";
      viewButton.addEventListener("click", function() {
        viewFile(fileName);
      });
      viewButton.title = "View File";
      // Download button
      const downloadButton = document.createElement("button");
      downloadButton.textContent = "Download";
      downloadButton.addEventListener("click", function() {
        downloadFile(fileName);
      });
      downloadButton.title = "Download File";
      // Rename button
      const renameButton = document.createElement("button");
      renameButton.textContent = "Rename";
      renameButton.addEventListener("click", function() {
        renameFile(fileName, listItem);
      });
      renameButton.title = "Rename File";
      // Remove button
      const removeButton = document.createElement("button");
      removeButton.textContent = "Remove";
      removeButton.addEventListener("click", function() {
        const confirmation = confirm("Are you sure you want to remove this file?");
        if (confirmation) {
          localStorage.removeItem(fileName);
          updateStorageInfo();
          listItem.remove();
        }
      });
      removeButton.title = "Remove File";
      // Append buttons to list item
      listItem.appendChild(viewButton);
      listItem.appendChild(downloadButton);
      listItem.appendChild(renameButton);
      listItem.appendChild(removeButton);
      filesList.appendChild(listItem);
    }
    // Function to view file
    function viewFile(fileName) {
      const fileContent = localStorage.getItem(fileName);
      const mimeType = fileContent.split(",")[0].split(":")[1].split(";")[0];
      // Check for supported file types
      if (mimeType.startsWith("image")) {
        displayImage(fileContent);
      } else if (mimeType === "application/pdf") {
        displayPDF(fileContent, fileName);
      } else if (mimeType === "text/plain") {
        displayText(fileContent);
      } else if (mimeType.startsWith("video")) {
        displayVideo(fileContent);
      } else if (mimeType.startsWith("audio")) {
        displayAudio(fileContent);
      } else {
        alert("File type not supported for preview.");
      }
    }
    // Function to display PDF preview
    function displayPDF(fileContent, fileName) {
      const pdfURL = URL.createObjectURL(dataURItoBlob(fileContent));
      window.open(pdfURL, `_blank`, `height=700,width=900`);
    }
    // Function to display text preview
    function displayText(fileContent) {
      const textPreview = document.createElement("pre");
      textPreview.textContent = fileContent;
      const previewWindow = window.open("", "_blank");
      previewWindow.document.body.appendChild(textPreview);
    }
    // Function to display image preview
    function displayImage(fileContent) {
      const imagePreview = document.createElement("img");
      imagePreview.src = fileContent;
      imagePreview.classList.add("file-preview");
      const previewWindow = window.open("", "_blank");
      previewWindow.document.body.appendChild(imagePreview);
    }
    // Function to display video preview
    function displayVideo(fileContent) {
      const videoPreview = document.createElement("video");
      videoPreview.src = fileContent;
      videoPreview.controls = true;
      const previewWindow = window.open("", "_blank");
      previewWindow.document.body.appendChild(videoPreview);
    }
    // Function to display audio preview
    function displayAudio(fileContent) {
      const audioPreview = document.createElement("audio");
      audioPreview.src = fileContent;
      audioPreview.controls = true;
      const previewWindow = window.open("", "_blank");
      previewWindow.document.body.appendChild(audioPreview);
    }
    // Function to download file
    function downloadFile(fileName) {
      const fileContent = localStorage.getItem(fileName);
      const blob = dataURItoBlob(fileContent);
      const url = URL.createObjectURL(blob);
      const link = document.createElement("a");
      link.href = url;
      link.download = fileName;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
    }
    // Function to rename file
    function renameFile(oldFileName, listItem) {
      const newFileName = prompt("Enter a new name for the file:", oldFileName);
      if (newFileName !== null && newFileName !== "") {
        const fileContent = localStorage.getItem(oldFileName);
        localStorage.removeItem(oldFileName);
        localStorage.setItem(newFileName, fileContent);
        listItem.textContent = `${newFileName} (${formatSize(fileContent.length * 2)})`;
      }
    }
    // Function to convert data URI to blob
    function dataURItoBlob(dataURI) {
      const byteString = atob(dataURI.split(",")[1]);
      const mimeString = dataURI.split(",")[0].split(":")[1].split(";")[0];
      const ab = new ArrayBuffer(byteString.length);
      const ia = new Uint8Array(ab);
      for (let i = 0; i < byteString.length; i++) {
        ia[i] = byteString.charCodeAt(i);
      }
      return new Blob([ab], {
        type: mimeString
      });
    }
    // Function to format file size
    function formatSize(bytes) {
      if (bytes < 1024) {
        return bytes + " B";
      } else if (bytes < 1024 * 1024) {
        return (bytes / 1024).toFixed(2) + " KB";
      } else {
        return (bytes / (1024 * 1024)).toFixed(2) + " MB";
      }
    }
    // Function to show upload message
    function showUploadMessage(message) {
      const uploadMessage = document.getElementById("uploadMessage");
      uploadMessage.textContent = message;
      uploadMessage.style.display = "block";
      setTimeout(() => {
        uploadMessage.textContent = "";
        uploadMessage.style.display = "none";
      }, 5000);
    }
    // Dark mode toggle event listener
    const darkModeToggle = document.getElementById("darkModeToggle");
    const body = document.body;
    // Function to toggle appearance mode and save to local storage
    function toggleAppearanceMode() {
      body.classList.toggle("dark-mode");
      const mode = body.classList.contains("dark-mode") ? "dark" : "light";
      localStorage.setItem("appearanceMode", mode);
    }
    // Event listener for appearance mode toggle button
    darkModeToggle.addEventListener("click", () => {
      toggleAppearanceMode();
    });
    // Function to apply saved appearance mode on page load
    function applySavedAppearanceMode() {
      const mode = localStorage.getItem("appearanceMode");
      if (mode === "dark") {
        body.classList.add("dark-mode");
      }
    }
    // Apply saved appearance mode on page load
    applySavedAppearanceMode();
    // Loop through local storage to add existing files to the list
    for (let i = 0; i < localStorage.length; i++) {
      const fileName = localStorage.key(i);
      // Exclude items related to appearance storage
      if (fileName !== "appearanceMode") {
        const fileSize = localStorage.getItem(fileName).length * 2;
        addFileToList(fileName, fileSize);
      }
    }
    // Update storage information
    updateStorageInfo();
  </script>
</body>

</html>
